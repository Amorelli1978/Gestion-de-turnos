
{% extends 'layout.html' %}

{% block title %}
    {% if action == 'new' %}
        Agregar Turno
    {% else %}
        Editar Turno
    {% endif %}
{% endblock %}

{% block content %}
    <h1>
        {% if action == 'new' %}
            Agregar Nuevo Turno
        {% else %}
            Editar Turno
        {% endif %}
    </h1>

    <form method="post" action="{% if action == 'new' %}{{ url_for('add_turno') }}{% else %}{{ url_for('edit_turno', id=turno['id']) }}{% endif %}">
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="paciente_id" class="form-label">Paciente</label>
                <select class="form-select" id="paciente_id" name="paciente_id" required>
                    {% for p in pacientes %}
                        <option value="{{ p['id'] }}" {% if turno and turno['paciente_id'] == p['id'] %}selected{% endif %}>
                            {{ p['apellido'] }}, {{ p['nombre'] }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label for="profesional_id" class="form-label">Profesional</label>
                <select class="form-select" id="profesional_id" name="profesional_id" required>
                    {% for p in profesionales %}
                        <option value="{{ p['id'] }}" {% if turno and turno['profesional_id'] == p['id'] %}selected{% endif %}>
                            {{ p['apellido'] }}, {{ p['nombre'] }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 mb-3">
                <label for="fecha" class="form-label">Fecha</label>
                <input type="date" class="form-control" id="fecha" name="fecha" value="{{ turno['fecha'] if turno else '' }}" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="hora" class="form-label">Hora</label>
                <input type="time" class="form-control" id="hora" name="hora" value="{{ turno['hora'] if turno else '' }}" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="estado" class="form-label">Estado</label>
                <select class="form-select" id="estado" name="estado" required>
                    {% set estados = ['Programado', 'Confirmado', 'Atendido', 'Cancelado', 'No Asisti√≥'] %}
                    {% for e in estados %}
                        <option value="{{ e }}" {% if turno and turno['estado'] == e %}selected{% endif %}>{{ e }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="mb-3">
            <label for="observaciones" class="form-label">Observaciones</label>
            <textarea class="form-control" id="observaciones" name="observaciones" rows="3">{{ turno['observaciones'] if turno else '' }}</textarea>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-primary">
                {% if action == 'new' %}
                    Guardar Turno
                {% else %}
                    Actualizar Turno
                {% endif %}
            </button>
            <a href="{{ url_for('list_turnos') }}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
{% endblock %}
